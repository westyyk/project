<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Task Manager</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="light">
<header>
  <h1>Task Manager</h1>
  <div class="user-block">
    <span>Привет, {{ user.username }}</span>
    <a href="{{ url_for('logout') }}">Выйти</a>
    <button id="theme-toggle">Тёмная/Светлая</button>
  </div>
</header>

<main>
  <aside class="sidebar">
    <form method="get" action="{{ url_for('index') }}" class="search-form">
      <input type="text" name="q" placeholder="Поиск по названию" value="{{ q }}">
      <button type="submit">Поиск</button>
    </form>

    <div class="categories">
      <h3>Категории</h3>
      <form method="post" action="{{ url_for('add_category') }}">
        <input name="category_name" placeholder="Новая категория">
        <button type="submit">Добавить</button>
      </form>
      <ul>
        <li><a href="{{ url_for('index', category='all') }}" class="{{ 'active' if selected_category=='all' else '' }}">Все</a></li>
        {% for c in categories %}
        <li>
          <a href="{{ url_for('index', category=c.id) }}" class="{{ 'active' if (selected_category|string)==(c.id|string) else '' }}">{{ c['name'] }}</a>
        </li>
        {% endfor %}
      </ul>
      <div class="sort">
        <span>Сортировать:</span>
        <a href="{{ url_for('index', sort='deadline') }}">по дедлайну</a> |
        <a href="{{ url_for('index', sort='created') }}">по дате создания</a>
      </div>
    </div>
  </aside>

  <section class="content">
    <section class="create-task">
      <h2>Создать задачу</h2>
      <form method="post" action="{{ url_for('index') }}">
        <input type="hidden" name="form_type" value="create_task">
        <input name="title" placeholder="Заголовок" required>
        <textarea name="description" placeholder="Описание (необязательно)"></textarea>
        <select name="category_id">
          <option value="">Без категории</option>
          {% for c in categories %}
            <option value="{{ c.id }}">{{ c.name }}</option>
          {% endfor %}
        </select>
        <label>Дедлайн:
          <input type="date" name="deadline">
        </label>
        <button type="submit">Создать</button>
      </form>
    </section>

    <section class="tasks-list">
      <h2>Задачи</h2>
      {% if tasks|length == 0 %}
        <p>Задач нет — создайте первую.</p>
      {% endif %}
      <ul>
        {% for t in tasks %}
        <li class="task-item {% if t.overdue %}overdue{% endif %} {% if t.completed %}done{% endif %}">
          <div class="task-main">
            <h3>{{ t.title }}</h3>
            <div class="meta">
              {% if t.category_name %}<span class="chip">{{ t.category_name }}</span>{% endif %}
              {% if t.deadline %}<span>Дедлайн: {{ t.deadline }}</span>{% endif %}
              <span>Статус: <strong>{{ t.status }}</strong></span>
            </div>
            <p class="desc">{{ t.description }}</p>
          </div>
          <div class="task-actions">
            <a href="{{ url_for('toggle', task_id=t.id) }}">{{ 'Снять' if t.completed else 'Отметить' }}</a>
            <a href="{{ url_for('edit', task_id=t.id) }}">Изменить</a>
            <form method="post" action="{{ url_for('delete', task_id=t.id) }}" style="display:inline">
              <button type="submit" onclick="return confirm('Удалить задачу?')">Удалить</button>
            </form>
          </div>
        </li>
        {% endfor %}
      </ul>
    </section>
  </section>
</main>

<footer>
  <small>Task Manager — простое приложение для учёта задач</small>
</footer>

<script>
  // theme toggle
  const btn = document.getElementById('theme-toggle');
  btn.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    document.body.classList.toggle('light');
  });
</script>
</body>
</html>
